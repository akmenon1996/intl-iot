# Documentation for getting predictions on unseen data for new device. 

## Step 1: Knn model development
If the knn model for the particular device is not available, then use the following steps for developing the knn model. 

- Convert the tagged pcap files for the device to text files by running raw2intermediate.sh
- Run the extract_features.py to generate features from the text files. 
- Run eval_models.py by passing knn as the model parameter. 
- Use the generated model from eval_models.py as the base model. 

## Step 2: Anomaly model development
- Use the anomaly-detection-notebooks/anomaly_detection.ipynb notebook to generate a multivariate anomaly detection model for your device. 
- While setting threshold make sure to analyse what threshold works best for your device. Ideally crossvalidate from -100000 to +400. 
- Save model. 


## Step 3: Prediction on new data. 
- Use the sliding_split.py to split your data into smaller time steps if neccessary. 
    - Ideally set time_window to 30 seconds. 
    - If you do not want to analyse specific time steps set slide_int = time_window.
    - If you want a sliding window the set slide_int to a value less than time_window. Ideally less than 10. 
- Use the code/anomaly-predict-newdata.py by changing the label, base_model and root_model addresses and pass the new data path. 

## Step 4: Evaluation
- Use Results.ipynb and replace the results variable with the path to the results file generated in the last step. 

- Example Evaluation for yi-camera

    - Accuracy in anomaly detection(True Positives) 
		
		97.59%
		Explanation: We consider all the activations generated by the device as anomalies. To calculate this accuracy we are comparing to see
		if the time range in which the accuracy has been predicted for actually has an activation or not, on the basis of our
		labelled data. If so then it is a true positive else it is a false positive. The total number of true positives/total predictions is our 
		calculated accuracy above. 
	- Accuracy in the labeling of the anomaly
		55.66%
		Explanation: For this metric we are looking to see if the label predicted for that particular time step 
		matches with that of the actual activation on the basis of the tagged data. If it does then it is a true positive, 
		else it is a false positive. The total number of true positives/total predictions is our 
		calculated accuracy above.
		The number of misclaasified labels/the total number of times they have been predicted are found in the table below. 




| Label                 | Wrongly Labelled/Total Instances |
|-----------------------|----------------------------------|
| android_lan_photo     | 142/255                          |
| android_wan_photo     | 69/112                           |
| android_lan_recording | 17/23                            |
| android_lan_watch     | 251/537                          |
| android_wan_watch     | 499/1273                         |
| android_wan_recording | 0/7                              |
| local_move            | 1/1                              |